// -------------------------------------------------------
// Prisma Schema for Reverse Auction Platform (ra-platform-6)
// -------------------------------------------------------

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// -------------------------------------------------------
//  USER MODEL
//  Buyers and Suppliers share this table (role field differentiates)
// -------------------------------------------------------
model User {
  id        String    @id @default(cuid())
  name      String?
  email     String    @unique
  password  String
  role      String    // "buyer" | "supplier"
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relations
  auctionsCreated Auction[] @relation("BuyerAuctions")
  bids            Bid[]
  invites         Invite[]
}

// -------------------------------------------------------
//  AUCTION MODEL
//  Created by Buyers, participated in by Suppliers
// -------------------------------------------------------
model Auction {
  id                String    @id @default(cuid())
  title             String
  description       String?
  startTime         DateTime  @default(now())
  endTime           DateTime
  durationMinutes   Int
  minDecrementValue Float
  status            String    @default("active") // "active", "closed", "cancelled"

  // Foreign Key
  buyerId String
  buyer   User      @relation("BuyerAuctions", fields: [buyerId], references: [id])

  // Relations
  bids    Bid[]
  invites Invite[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// -------------------------------------------------------
//  BID MODEL
//  Each supplier can place multiple bids on one auction
// -------------------------------------------------------
model Bid {
  id          String   @id @default(cuid())
  amount      Float
  createdAt   DateTime @default(now())
  rank        Int?
  supplierId  String
  auctionId   String

  supplier User    @relation(fields: [supplierId], references: [id])
  auction  Auction @relation(fields: [auctionId], references: [id])
}

// -------------------------------------------------------
//  INVITE MODEL
//  Tracks which suppliers were invited to which auctions
// -------------------------------------------------------
model Invite {
  id          String   @id @default(cuid())
  supplierId  String
  auctionId   String
  email       String
  invitedAt   DateTime @default(now())

  supplier User    @relation(fields: [supplierId], references: [id])
  auction  Auction @relation(fields: [auctionId], references: [id])
}
